{% extends 'base.html' %}
{% load static %}
{% load self_assessment_filters %}

{% block title %}Самооценка{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/self-assessment.css' %}" />
{% endblock %}

{% block content %}
<div class="assessment-container">
    <form id="assessment-form">
        {% csrf_token %}

        <!-- Выбор направления -->
        <div class="direction-selection cards-grid">
            {% for key, block in data.blocks.items %}
                <div class="card direction-card" data-direction="{{ key }}">
                    <div class="card-content direction-content">
                        <div class="card-icon direction-icon">
                            <i class="bi {% if key == 'hw' %}bi-cpu{% elif key == 'sw' %}bi-code-square{% else %}bi-gear{% endif %}"></i>
                        </div>
                        <div class="card-info direction-info">
                            <h3 class="card-name direction-name">{{ block.name }}</h3>
                            <span class="card-description direction-count">{{ block.items|length }} продуктов</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Основной контент -->
        <div class="main-content" style="display: none;">
            <div class="cards-split">
                <!-- Карточка с фильтрацией -->
                <div class="card card-sidebar filter-section">
                    <div class="card-body">
                        <div class="filter-header">
                            <button type="button" class="back-button">
                                <i class="bi bi-arrow-left"></i>
                                <span>Назад к выбору направления</span>
                            </button>
                            <h3 class="card-title direction-title"></h3>
                        </div>
                        <div class="filter-body">
                            <div class="search-box">
                                <i class="bi bi-search"></i>
                                <input type="text" class="search-input" placeholder="Поиск по задачам...">
                            </div>
                            <div class="tasks-list">
                                <!-- Задачи будут добавлены динамически -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Карточка с продуктами -->
                <div class="card card-main products-section">
                    <div class="card-body">
                        <h3 class="card-title">Продукты</h3>
                        <div class="card-scrollable">
                            <div class="products-grid cards-grid">
                                {% for key, block in data.blocks.items %}
                                    <div class="products-block" id="products_{{ key }}" style="display: none;">
                                        {% for product, disciplines in block.items.items %}
                                            <div class="card product-card" data-tasks="{{ disciplines|join:',' }}">
                                                <div class="card-content">
                                                    <div class="card-icon product-icon">
                                                        {% if key == 'hw' %}
                                                            <i class="bi bi-hdd"></i>
                                                        {% elif key == 'sw' %}
                                                            <i class="bi bi-window"></i>
                                                        {% else %}
                                                            <i class="bi bi-diagram-3"></i>
                                                        {% endif %}
                                                    </div>
                                                    <div class="card-info product-info">
                                                        <span class="card-name product-name">{{ product }}</span>
                                                        <span class="card-description product-tasks">{{ disciplines|length }} задач{% if disciplines|length > 1 %}и{% endif %}</span>
                                                    </div>
                                                </div>
                                                <div class="product-details" style="display: none;">
                                                    {% for discipline in disciplines %}
                                                        <div class="discipline-section">
                                                            <h5>{{ discipline }}</h5>
                                                            <div class="options-grid">
                                                                {% for weight, level, description in data.levels %}
                                                                    <label class="option-card">
                                                                        <input type="radio"
                                                                               class="option-input"
                                                                               name="{{ product|replace_dj:" |_" }}_{{ discipline|replace_dj:" |_" }}"
                                                                               value="{{ level }}"
                                                                               required>
                                                                        <div class="option-content">
                                                                            <span class="option-text">{{ level }}</span>
                                                                            <span class="option-description">{{ description }}</span>
                                                                        </div>
                                                                    </label>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Кнопка завершения -->
            <button type="button" class="finish-button" id="finish-button" style="display: none;">
                <span class="button-content">
                    <i class="bi bi-check-circle"></i>
                    <span class="button-text">Завершить</span>
                </span>
            </button>
        </div>
    </form>
</div>

<!-- Модальное окно -->
<div class="modal fade" id="restoreModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Восстановление данных</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Найдена незавершенная форма. Хотите продолжить?</p>
                <p class="text-muted">(В случае отказа данные будут стёрты)</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="modal-accept">Продолжить</button>
                <button type="button" class="btn btn-secondary" id="modal-decline">Очистить</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/self-assessment.js' %}"></script>
{% endblock %}